"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _fs = _interopRequireDefault(require("fs"));
var _path = _interopRequireDefault(require("path"));function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}

var MUSIC_BANK = './src/music/';
var ALARM_DURATION_SEC = 4;

var playerFactory = function playerFactory() {
  var player = require('play-sound')({ mplayer: [] });
  var process = null;
  var isPlaying = false;

  var stopPlaying = function stopPlaying() {
    console.log('SOUND STOPPED');
    isPlaying = false;
    if (process) {
      process.kill('SIGINT');
      process = null;
    }
  };
  var getRandomSound = function getRandomSound() {
    var songs = _fs.default.readdirSync(MUSIC_BANK).map(function (file) {
      return _path.default.join(MUSIC_BANK, file);
    });

    var songsAmount = songs.length;
    var randomIndex = Math.floor(songsAmount * Math.random());
    return songs[randomIndex];
  };

  return {
    playRandom: function playRandom() {
      if (isPlaying) {
        return;
      }
      isPlaying = true;
      var song = getRandomSound();
      console.log('SOUND FIRED');
      process = player.play(song, function (err) {
        if (err) {
          stopPlaying();
        }
        isPlaying = false;
        process = null;
      });
      setTimeout(stopPlaying, 1000 * ALARM_DURATION_SEC);
    },
    stop: stopPlaying };

};var _default =

playerFactory;exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zb3VuZFBsYXllckZhY3RvcnkuanMiXSwibmFtZXMiOlsiTVVTSUNfQkFOSyIsIkFMQVJNX0RVUkFUSU9OX1NFQyIsInBsYXllckZhY3RvcnkiLCJwbGF5ZXIiLCJyZXF1aXJlIiwibXBsYXllciIsInByb2Nlc3MiLCJpc1BsYXlpbmciLCJzdG9wUGxheWluZyIsImNvbnNvbGUiLCJsb2ciLCJraWxsIiwiZ2V0UmFuZG9tU291bmQiLCJzb25ncyIsImZzIiwicmVhZGRpclN5bmMiLCJtYXAiLCJmaWxlIiwicGF0aCIsImpvaW4iLCJzb25nc0Ftb3VudCIsImxlbmd0aCIsInJhbmRvbUluZGV4IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicGxheVJhbmRvbSIsInNvbmciLCJwbGF5IiwiZXJyIiwic2V0VGltZW91dCIsInN0b3AiXSwibWFwcGluZ3MiOiJvR0FBQTtBQUNBLG9EOztBQUVBLElBQU1BLFVBQVUsR0FBRyxjQUFuQjtBQUNBLElBQU1DLGtCQUFrQixHQUFHLENBQTNCOztBQUVBLElBQU1DLGFBQWEsR0FBRyxTQUFoQkEsYUFBZ0IsR0FBTTtBQUMxQixNQUFNQyxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxZQUFELENBQVAsQ0FBc0IsRUFBRUMsT0FBTyxFQUFFLEVBQVgsRUFBdEIsQ0FBZjtBQUNBLE1BQUlDLE9BQU8sR0FBRyxJQUFkO0FBQ0EsTUFBSUMsU0FBUyxHQUFHLEtBQWhCOztBQUVBLE1BQU1DLFdBQVcsR0FBRyxTQUFkQSxXQUFjLEdBQU07QUFDeEJDLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLGVBQVo7QUFDQUgsSUFBQUEsU0FBUyxHQUFHLEtBQVo7QUFDQSxRQUFJRCxPQUFKLEVBQWE7QUFDWEEsTUFBQUEsT0FBTyxDQUFDSyxJQUFSLENBQWEsUUFBYjtBQUNBTCxNQUFBQSxPQUFPLEdBQUcsSUFBVjtBQUNEO0FBQ0YsR0FQRDtBQVFBLE1BQU1NLGNBQWMsR0FBRyxTQUFqQkEsY0FBaUIsR0FBTTtBQUMzQixRQUFNQyxLQUFLLEdBQUdDLFlBQUdDLFdBQUgsQ0FBZWYsVUFBZixFQUEyQmdCLEdBQTNCLENBQStCLFVBQUNDLElBQUQsRUFBVTtBQUNyRCxhQUFPQyxjQUFLQyxJQUFMLENBQVVuQixVQUFWLEVBQXNCaUIsSUFBdEIsQ0FBUDtBQUNELEtBRmEsQ0FBZDs7QUFJQSxRQUFNRyxXQUFXLEdBQUdQLEtBQUssQ0FBQ1EsTUFBMUI7QUFDQSxRQUFNQyxXQUFXLEdBQUdDLElBQUksQ0FBQ0MsS0FBTCxDQUFXSixXQUFXLEdBQUdHLElBQUksQ0FBQ0UsTUFBTCxFQUF6QixDQUFwQjtBQUNBLFdBQU9aLEtBQUssQ0FBQ1MsV0FBRCxDQUFaO0FBQ0QsR0FSRDs7QUFVQSxTQUFPO0FBQ0xJLElBQUFBLFVBQVUsRUFBRSxzQkFBTTtBQUNoQixVQUFJbkIsU0FBSixFQUFlO0FBQ2I7QUFDRDtBQUNEQSxNQUFBQSxTQUFTLEdBQUcsSUFBWjtBQUNBLFVBQU1vQixJQUFJLEdBQUdmLGNBQWMsRUFBM0I7QUFDQUgsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksYUFBWjtBQUNBSixNQUFBQSxPQUFPLEdBQUdILE1BQU0sQ0FBQ3lCLElBQVAsQ0FBWUQsSUFBWixFQUFrQixVQUFVRSxHQUFWLEVBQWU7QUFDekMsWUFBSUEsR0FBSixFQUFTO0FBQ1ByQixVQUFBQSxXQUFXO0FBQ1o7QUFDREQsUUFBQUEsU0FBUyxHQUFHLEtBQVo7QUFDQUQsUUFBQUEsT0FBTyxHQUFHLElBQVY7QUFDRCxPQU5TLENBQVY7QUFPQXdCLE1BQUFBLFVBQVUsQ0FBQ3RCLFdBQUQsRUFBYyxPQUFPUCxrQkFBckIsQ0FBVjtBQUNELEtBaEJJO0FBaUJMOEIsSUFBQUEsSUFBSSxFQUFFdkIsV0FqQkQsRUFBUDs7QUFtQkQsQ0ExQ0QsQzs7QUE0Q2VOLGEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbmNvbnN0IE1VU0lDX0JBTksgPSAnLi9zcmMvbXVzaWMvJztcbmNvbnN0IEFMQVJNX0RVUkFUSU9OX1NFQyA9IDQ7XG5cbmNvbnN0IHBsYXllckZhY3RvcnkgPSAoKSA9PiB7XG4gIGNvbnN0IHBsYXllciA9IHJlcXVpcmUoJ3BsYXktc291bmQnKSh7IG1wbGF5ZXI6IFtdIH0pO1xuICBsZXQgcHJvY2VzcyA9IG51bGw7XG4gIGxldCBpc1BsYXlpbmcgPSBmYWxzZTtcblxuICBjb25zdCBzdG9wUGxheWluZyA9ICgpID0+IHtcbiAgICBjb25zb2xlLmxvZygnU09VTkQgU1RPUFBFRCcpO1xuICAgIGlzUGxheWluZyA9IGZhbHNlO1xuICAgIGlmIChwcm9jZXNzKSB7XG4gICAgICBwcm9jZXNzLmtpbGwoJ1NJR0lOVCcpO1xuICAgICAgcHJvY2VzcyA9IG51bGw7XG4gICAgfVxuICB9O1xuICBjb25zdCBnZXRSYW5kb21Tb3VuZCA9ICgpID0+IHtcbiAgICBjb25zdCBzb25ncyA9IGZzLnJlYWRkaXJTeW5jKE1VU0lDX0JBTkspLm1hcCgoZmlsZSkgPT4ge1xuICAgICAgcmV0dXJuIHBhdGguam9pbihNVVNJQ19CQU5LLCBmaWxlKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHNvbmdzQW1vdW50ID0gc29uZ3MubGVuZ3RoO1xuICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihzb25nc0Ftb3VudCAqIE1hdGgucmFuZG9tKCkpO1xuICAgIHJldHVybiBzb25nc1tyYW5kb21JbmRleF07XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBwbGF5UmFuZG9tOiAoKSA9PiB7XG4gICAgICBpZiAoaXNQbGF5aW5nKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlzUGxheWluZyA9IHRydWU7XG4gICAgICBjb25zdCBzb25nID0gZ2V0UmFuZG9tU291bmQoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdTT1VORCBGSVJFRCcpO1xuICAgICAgcHJvY2VzcyA9IHBsYXllci5wbGF5KHNvbmcsIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHN0b3BQbGF5aW5nKCk7XG4gICAgICAgIH1cbiAgICAgICAgaXNQbGF5aW5nID0gZmFsc2U7XG4gICAgICAgIHByb2Nlc3MgPSBudWxsO1xuICAgICAgfSk7XG4gICAgICBzZXRUaW1lb3V0KHN0b3BQbGF5aW5nLCAxMDAwICogQUxBUk1fRFVSQVRJT05fU0VDKTtcbiAgICB9LFxuICAgIHN0b3A6IHN0b3BQbGF5aW5nLFxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgcGxheWVyRmFjdG9yeTtcbiJdfQ==