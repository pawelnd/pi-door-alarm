'use strict';
Object.defineProperty(exports, '__esModule', { value: true });
exports.default = void 0;
var _fs = _interopRequireDefault(require('fs'));
var _path = _interopRequireDefault(require('path'));
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

var MUSIC_BANK = './src/music/';
var ALARM_DURATION_SEC = 4;

var playerFactory = function playerFactory() {
  var player = require('play-sound')({ mplayer: [] });
  var process = null;
  var isPlaying = false;

  var stopPlaying = function stopPlaying() {
    console.log('SOUND STOPPED');
    isPlaying = false;
    if (process) {
      process.kill('SIGINT');
      process = null;
    }
  };
  var getRandomSound = function getRandomSound() {
    var songs = _fs.default
      .readdirSync(MUSIC_BANK)
      .map(function (file) {
        return _path.default.join(MUSIC_BANK, file);
      });

    var songsAmount = songs.length;
    var randomIndex = Math.floor(songsAmount * Math.random());
    return songs[randomIndex];
  };

  return {
    playRandom: function playRandom() {
      if (isPlaying) {
        return;
      }
      isPlaying = true;
      var song = getRandomSound();
      console.log('SOUND FIRED');
      process = player.play(song, function (err) {
        if (err) {
          stopPlaying();
        }
        isPlaying = false;
        process = null;
      });
      setTimeout(stopPlaying, 1000 * ALARM_DURATION_SEC);
    },
    stop: stopPlaying,
  };
};
var _default = playerFactory;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zb3VuZFBsYXllckZhY3RvcnkuanMiXSwibmFtZXMiOlsiTVVTSUNfQkFOSyIsIkFMQVJNX0RVUkFUSU9OX1NFQyIsInBsYXllckZhY3RvcnkiLCJwbGF5ZXIiLCJyZXF1aXJlIiwibXBsYXllciIsInByb2Nlc3MiLCJpc1BsYXlpbmciLCJzdG9wUGxheWluZyIsImNvbnNvbGUiLCJsb2ciLCJraWxsIiwiZ2V0UmFuZG9tU291bmQiLCJzb25ncyIsImZzIiwicmVhZGRpclN5bmMiLCJtYXAiLCJmaWxlIiwicGF0aCIsImpvaW4iLCJzb25nc0Ftb3VudCIsImxlbmd0aCIsInJhbmRvbUluZGV4IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicGxheVJhbmRvbSIsInNvbmciLCJwbGF5IiwiZXJyIiwic2V0VGltZW91dCIsInN0b3AiXSwibWFwcGluZ3MiOiJvR0FBQTtBQUNBLG9EOztBQUVBLElBQU1BLFVBQVUsR0FBRyxjQUFuQjtBQUNBLElBQU1DLGtCQUFrQixHQUFHLENBQTNCOztBQUVBLElBQU1DLGFBQWEsR0FBRyxTQUFoQkEsYUFBZ0IsR0FBTTtBQUMxQixNQUFNQyxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxZQUFELENBQVAsQ0FBc0IsRUFBQ0MsT0FBTyxFQUFFLEVBQVYsRUFBdEIsQ0FBZjtBQUNBLE1BQUlDLE9BQU8sR0FBRyxJQUFkO0FBQ0EsTUFBSUMsU0FBUyxHQUFHLEtBQWhCOztBQUVBLE1BQU1DLFdBQVcsR0FBRyxTQUFkQSxXQUFjLEdBQU07QUFDeEJDLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLGVBQVo7QUFDQUgsSUFBQUEsU0FBUyxHQUFHLEtBQVo7QUFDQSxRQUFHRCxPQUFILEVBQVc7QUFDVEEsTUFBQUEsT0FBTyxDQUFDSyxJQUFSLENBQWEsUUFBYjtBQUNBTCxNQUFBQSxPQUFPLEdBQUcsSUFBVjtBQUNEO0FBQ0YsR0FQRDtBQVFBLE1BQU1NLGNBQWMsR0FBRyxTQUFqQkEsY0FBaUIsR0FBTTtBQUMzQixRQUFNQyxLQUFLLEdBQUdDLFlBQUdDLFdBQUgsQ0FBZWYsVUFBZjtBQUNiZ0IsSUFBQUEsR0FEYSxDQUNULFVBQUFDLElBQUksRUFBSTtBQUNYLGFBQU9DLGNBQUtDLElBQUwsQ0FBVW5CLFVBQVYsRUFBc0JpQixJQUF0QixDQUFQO0FBQ0QsS0FIYSxDQUFkOztBQUtBLFFBQU1HLFdBQVcsR0FBR1AsS0FBSyxDQUFDUSxNQUExQjtBQUNBLFFBQU1DLFdBQVcsR0FBR0MsSUFBSSxDQUFDQyxLQUFMLENBQVdKLFdBQVcsR0FBR0csSUFBSSxDQUFDRSxNQUFMLEVBQXpCLENBQXBCO0FBQ0EsV0FBT1osS0FBSyxDQUFDUyxXQUFELENBQVo7QUFDRCxHQVREOztBQVdBLFNBQU87QUFDTEksSUFBQUEsVUFBVSxFQUFFLHNCQUFNO0FBQ2hCLFVBQUduQixTQUFILEVBQWEsQ0FBQyxPQUFRO0FBQ3RCQSxNQUFBQSxTQUFTLEdBQUcsSUFBWjtBQUNBLFVBQU1vQixJQUFJLEdBQUdmLGNBQWMsRUFBM0I7QUFDQUgsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksYUFBWjtBQUNBSixNQUFBQSxPQUFPLEdBQUdILE1BQU0sQ0FBQ3lCLElBQVAsQ0FBWUQsSUFBWixFQUFrQixVQUFTRSxHQUFULEVBQWE7QUFDdkMsWUFBSUEsR0FBSixFQUFTO0FBQ1ByQixVQUFBQSxXQUFXO0FBQ1o7QUFDREQsUUFBQUEsU0FBUyxHQUFHLEtBQVo7QUFDQUQsUUFBQUEsT0FBTyxHQUFHLElBQVY7QUFDRCxPQU5TLENBQVY7QUFPQXdCLE1BQUFBLFVBQVUsQ0FBQ3RCLFdBQUQsRUFBYyxPQUFPUCxrQkFBckIsQ0FBVjtBQUNELEtBZEk7QUFlTDhCLElBQUFBLElBQUksRUFBRXZCLFdBZkQsRUFBUDs7QUFpQkQsQ0F6Q0QsQzs7QUEyQ2VOLGEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSAnZnMnO1xyXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcclxuXHJcbmNvbnN0IE1VU0lDX0JBTksgPSAnLi9zcmMvbXVzaWMvJztcclxuY29uc3QgQUxBUk1fRFVSQVRJT05fU0VDID0gNDtcclxuXHJcbmNvbnN0IHBsYXllckZhY3RvcnkgPSAoKSA9PiB7XHJcbiAgY29uc3QgcGxheWVyID0gcmVxdWlyZSgncGxheS1zb3VuZCcpKHttcGxheWVyOiBbXX0pXHJcbiAgbGV0IHByb2Nlc3MgPSBudWxsO1xyXG4gIGxldCBpc1BsYXlpbmcgPSBmYWxzZTtcclxuXHJcbiAgY29uc3Qgc3RvcFBsYXlpbmcgPSAoKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhcIlNPVU5EIFNUT1BQRURcIilcclxuICAgIGlzUGxheWluZyA9IGZhbHNlO1xyXG4gICAgaWYocHJvY2Vzcyl7XHJcbiAgICAgIHByb2Nlc3Mua2lsbCgnU0lHSU5UJyk7XHJcbiAgICAgIHByb2Nlc3MgPSBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuICBjb25zdCBnZXRSYW5kb21Tb3VuZCA9ICgpID0+IHtcclxuICAgIGNvbnN0IHNvbmdzID0gZnMucmVhZGRpclN5bmMoTVVTSUNfQkFOSylcclxuICAgIC5tYXAoZmlsZSA9PiB7XHJcbiAgICAgIHJldHVybiBwYXRoLmpvaW4oTVVTSUNfQkFOSywgZmlsZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBzb25nc0Ftb3VudCA9IHNvbmdzLmxlbmd0aDtcclxuICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihzb25nc0Ftb3VudCAqIE1hdGgucmFuZG9tKCkpO1xyXG4gICAgcmV0dXJuIHNvbmdzW3JhbmRvbUluZGV4XTtcclxuICB9XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBwbGF5UmFuZG9tOiAoKSA9PiB7XHJcbiAgICAgIGlmKGlzUGxheWluZyl7cmV0dXJuO31cclxuICAgICAgaXNQbGF5aW5nID0gdHJ1ZTtcclxuICAgICAgY29uc3Qgc29uZyA9IGdldFJhbmRvbVNvdW5kKCk7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiU09VTkQgRklSRURcIilcclxuICAgICAgcHJvY2VzcyA9IHBsYXllci5wbGF5KHNvbmcsIGZ1bmN0aW9uKGVycil7XHJcbiAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgc3RvcFBsYXlpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaXNQbGF5aW5nID0gZmFsc2U7XHJcbiAgICAgICAgcHJvY2VzcyA9IG51bGw7XHJcbiAgICAgIH0pXHJcbiAgICAgIHNldFRpbWVvdXQoc3RvcFBsYXlpbmcsIDEwMDAgKiBBTEFSTV9EVVJBVElPTl9TRUMpO1xyXG4gICAgfSxcclxuICAgIHN0b3A6IHN0b3BQbGF5aW5nXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBwbGF5ZXJGYWN0b3J5O1xyXG4iXX0=
